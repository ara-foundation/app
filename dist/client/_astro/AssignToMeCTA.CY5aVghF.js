import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.DxhH1ShK.js";import{B as C}from"./Button.BK-c6KtM.js";import{C as v}from"./Tooltip.CRI7KqtE.js";import{A as I}from"./AuthStar.nxAGzTTY.js";import{L as A}from"./login-require-for-panel.DJDXBtn0.js";import{a as L,g as N}from"./auth.C6MmFFld.js";import{g as _,a as B}from"./star.J0JRTi5O.js";import{g as M,u as P,s as T}from"./issue.Cu6yhr5C.js";import{c as R}from"./utils.BnlJtBIq.js";import{I as w}from"./issue.CJErfNqu.js";import"./ripple.8VKTSqqU.js";import"./slot.RkfkL2mj.js";import"./proxy.D4YeN7SK.js";import"./ElectricBorder.DAWLx7iV.js";import"./index.C2SuE_cr.js";import"./index.CqUFkXl9.js";import"./index.CG_O7YBG.js";import"./Link.BGo-y1Vn.js";import"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import"./icon.Df9DBUhx.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";const at=({issueId:i})=>{const{data:a,isPending:g}=L.useSession(),[S,u]=s.useState(!1),[d,l]=s.useState(!1),[m,f]=s.useState(null),[n,h]=s.useState(null),[p,b]=s.useState(null),[c,x]=s.useState(null),[j,y]=s.useState(!1);s.useEffect(()=>{(async()=>{const t=await M(i);t&&h(t)})()},[i]),s.useEffect(()=>{(async()=>{if(g)return;const t=a?.user;if(t?.id&&n){const o=await B(t.id);if(o&&o._id){f(o);const U=o._id.toString();u(n.maintainer===U)}else f(null),u(!1)}else f(null),u(!1)})()},[a,g,n]),s.useEffect(()=>{n?.contributor&&typeof n.contributor=="string"?(y(!0),_(n.contributor).then(async r=>{if(r&&(b(r),r.userId)){const t=await N(r.userId);t&&x(t)}}).catch(r=>{console.error("Error fetching contributor:",r)}).finally(()=>{y(!1)})):(b(null),x(null))},[n?.contributor]),s.useEffect(()=>{const r=t=>{const o=t;o.detail&&o.detail._id===i&&h(o.detail)};return window.addEventListener(w.ISSUE_UPDATE,r),()=>{window.removeEventListener(w.ISSUE_UPDATE,r)}},[i]);const k=async()=>{if(!a?.user?.id){alert("Please log in to assign contributor");return}if(!m||!m._id){alert("User not found");return}l(!0);try{await T({issueId:i,userId:m._id.toString()})||alert("Failed to assign contributor")}catch(t){console.error("Error assigning contributor:",t),alert("An error occurred while assigning contributor")}finally{l(!1)}},E=async()=>{if(!a?.user?.id){alert("Please log in to unset contributor");return}l(!0);try{await P({issueId:i})||alert("Failed to unset contributor")}catch(t){console.error("Error unsetting contributor:",t),alert("An error occurred while unsetting contributor")}finally{l(!1)}};return S?e.jsx(A,{children:e.jsx("div",{className:R("fixed bottom-4 right-1/2 translate-x-1/2 z-40","backdrop-blur-md bg-white/90 dark:bg-slate-900/90","border border-slate-200/50 dark:border-slate-700/50","rounded-lg shadow-lg","transition-all duration-300","hover:shadow-xl hover:scale-105"),children:p?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Contributor"}),j?e.jsx("span",{className:"text-xs text-gray-400",children:"Loading..."}):e.jsx(I,{src:c?.image,nickname:c?.name||c?.username||c?.email?.split("@")[0]||"Unknown",star:p,className:"w-6! h-6!"}),e.jsx(v,{openDelay:500,content:e.jsx("div",{className:"text-sm",children:"Cancel the contributor"}),children:e.jsx("button",{onClick:E,disabled:d,className:"w-5 h-5 flex items-center justify-center rounded hover:bg-slate-200 dark:hover:bg-slate-700 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition-colors disabled:opacity-50","aria-label":"Cancel the contributor",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]}):e.jsxs(C,{variant:"primary",outline:!0,size:"lg",onClick:k,disabled:d,className:"px-6 py-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:d?"Assigning...":"Assign To Me"})]})})}):null};export{at as default};
