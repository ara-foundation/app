import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.DxhH1ShK.js";import{B as y}from"./Button.BK-c6KtM.js";import{S as P,a as u}from"./ScrollStack.BC0PwliQ.js";import{B as z}from"./Badge.CwoN8wRJ.js";import{R as q,T as K,a as O,b as W}from"./index.DPkKMAGE.js";import{b as c,I as G}from"./issue.CJErfNqu.js";import{a as V}from"./auth.C6MmFFld.js";import{c as _}from"./issue.Cu6yhr5C.js";import{a as Y}from"./star.J0JRTi5O.js";import{N as T}from"./NumberFlow-client-48rw3j0J.DO-Ted3l.js";import{c as C}from"./utils.BnlJtBIq.js";import{L as J}from"./login-require-for-panel.DJDXBtn0.js";import"./ripple.8VKTSqqU.js";import"./slot.RkfkL2mj.js";import"./proxy.D4YeN7SK.js";import"./ElectricBorder.DAWLx7iV.js";import"./index.DpQ8kv17.js";import"./index.C2SuE_cr.js";import"./index.CqUFkXl9.js";import"./index.Du2_2VfY.js";import"./index.DXWCtkbr.js";import"./index.DPjcTRdc.js";import"./virtual.VUcB3V37.js";import"./client.B9YBqyHK.js";const Q=({galaxyId:x,onSuccess:p,onCancel:o})=>{const[l,g]=r.useState(""),[m,I]=r.useState(""),[i,L]=r.useState([]),[b,A]=r.useState(0),[k,R]=r.useState(0),[v,w]=r.useState(!1),[F,D]=r.useState(!0),[N,M]=r.useState(0),d=r.useRef(null),n=r.useRef([]),U=r.useRef(null),{data:j,isPending:S}=V.useSession();r.useEffect(()=>{(async()=>{if(!S)try{const s=j?.user;if(s?.id){const a=await Y(s.id);a&&R(a.sunshines||0)}}catch(s){console.error("Error fetching user sunshines:",s)}finally{D(!1)}})()},[j,S]);const B=e=>{L(s=>s.includes(e)?s.filter(a=>a!==e):[...s,e])},f=r.useCallback(()=>{if(n.current.length===0||!d.current)return;const e=Math.min(N+1,n.current.length-1),s=n.current[e];if(s&&d.current){const a=d.current.querySelector(".scroll-stack-inner");if(a){const h=s.offsetTop-a.offsetTop;a.scrollTo({top:h-100,behavior:"smooth"}),M(e)}}},[N]);r.useEffect(()=>{const e=s=>{s.target instanceof HTMLTextAreaElement&&s.key==="Enter"&&s.shiftKey||(s.key==="Enter"||s.key==="Tab")&&(s.key==="Tab"&&!(s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement)&&s.preventDefault(),s.key==="Enter"&&(s.target instanceof HTMLInputElement||s.target instanceof HTMLTextAreaElement)&&(s.preventDefault(),f()))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f]),r.useEffect(()=>{const e=d.current?.querySelector(".scroll-stack-inner");if(!e)return;const s=()=>{};let a;const h=()=>{a=requestAnimationFrame(h)};return e.addEventListener("scroll",()=>{a||(a=requestAnimationFrame(h))}),()=>{a&&cancelAnimationFrame(a),e.removeEventListener("scroll",s)}},[]);const H=async()=>{if(!l.trim()||!m.trim()||i.length===0){alert("Please fill in all required fields (title, description, and at least one tag)");return}w(!0);try{const e=j?.user;if(!e?.id||!e?.email){alert("Please log in to create an issue"),w(!1);return}await _({galaxyId:x,userId:e.id,email:e.email,title:l.trim(),description:m.trim(),tags:i,sunshines:b})?p?.():alert("Failed to create issue")}catch(e){console.error("Error creating issue:",e),alert("An error occurred while creating the issue")}finally{w(!1)}},E=[{value:c.BUG,label:"Bug"},{value:c.FEATURE,label:"Feature"},{value:c.IMPROVEMENT,label:"Improvement"},{value:c.ENHANCEMENT,label:"Enhancement"},{value:c.WISH,label:"Wish"},{value:c.CUSTOM,label:"Custom"}];return t.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[o&&t.jsx("button",{onClick:o,className:"fixed top-16 right-16 z-50 pointer-events-auto w-10 h-10 rounded-sm bg-white/90 dark:bg-slate-950/95 backdrop-blur-md border border-slate-200/50 dark:border-slate-800/50 shadow-lg flex items-center justify-center text-slate-500 hover:text-slate-700 dark:hover:text-slate-200 transition-all hover:scale-110",children:"âœ•"}),t.jsx("div",{ref:d,className:"absolute bottom-0 left-0 right-0 h-[80vh] pointer-events-auto",children:t.jsxs(P,{useWindowScroll:!1,className:"h-full",children:[t.jsx(u,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{n.current[0]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Issue Title *"}),t.jsx("input",{ref:U,type:"text",value:l,onChange:e=>g(e.target.value),onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),f())},placeholder:"Enter a clear, descriptive title...",className:"w-full text-lg px-3 py-2 border border-gray-300/50 dark:border-slate-700/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/30 dark:bg-slate-900/40 backdrop-blur-md"})]})}),t.jsx(u,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{n.current[1]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Description *"}),t.jsx("textarea",{value:m,onChange:e=>I(e.target.value),onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),f())},placeholder:"Describe the issue in detail...",rows:6,className:"w-full px-3 py-2 border border-gray-300/50 dark:border-slate-700/50 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-cascade-blue focus:border-cascade-blue bg-white/30 dark:bg-slate-900/40 backdrop-blur-md resize-none"})]})}),t.jsx(u,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{n.current[2]=e},className:"space-y-4",children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300",children:"Tags * (Select at least one)"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:E.map(e=>t.jsx("button",{onClick:()=>B(e.value),className:C("px-4 py-2 rounded-lg transition-all backdrop-blur-sm",i.includes(e.value)?"bg-blue-500/90 text-white":"bg-slate-200/80 dark:bg-slate-800/80 text-slate-700 dark:text-slate-200 hover:bg-slate-300/90 dark:hover:bg-slate-700/90"),children:e.label},e.value))}),i.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:i.map(e=>t.jsx(z,{variant:"info",children:E.find(s=>s.value===e)?.label},e))})]})}),t.jsx(u,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsx("div",{ref:e=>{n.current[4]=e},className:"space-y-6",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-lg font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Allocate Sunshines (Optional)"}),F?t.jsx("p",{className:"text-slate-500",children:"Loading..."}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-600 dark:text-slate-400",children:[t.jsx("span",{children:"Available Sunshines:"}),t.jsx("span",{className:"font-semibold",children:t.jsx(T,{value:k,locales:"en-US",format:{useGrouping:!0}})})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-600 dark:text-slate-400",children:[t.jsx("span",{children:"Allocating:"}),t.jsx("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:t.jsx(T,{value:b,locales:"en-US",format:{useGrouping:!0}})})]}),t.jsxs(q,{value:[b],onValueChange:e=>A(e[0]),max:k,min:0,step:1,disabled:k===0,className:"relative flex h-5 w-full touch-none select-none items-center",children:[t.jsx(K,{className:"relative h-2 grow rounded-full bg-slate-200/80 dark:bg-slate-800/80 backdrop-blur-sm",children:t.jsx(O,{className:"absolute h-full rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 transition-all duration-100"})}),t.jsx(W,{className:"relative block h-5 w-5 rounded-full bg-yellow-400 dark:bg-yellow-500 shadow-md ring-2 ring-yellow-300 dark:ring-yellow-600 transition-all focus:outline-none focus:ring-2 focus:ring-yellow-500"})]}),t.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:b>0?"Issue will be added to Shining Issues":"Issue will be added to Public Backlog"})]})]})})}),t.jsx(u,{itemClassName:"bg-white/5 dark:bg-slate-900/10 backdrop-blur-md border border-white/10 dark:border-slate-700/20 transition-all duration-300",children:t.jsxs("div",{ref:e=>{n.current[5]=e},className:"flex flex-col items-center gap-4",children:[t.jsx(y,{variant:"primary",size:"lg",onClick:H,disabled:v||!l.trim()||!m.trim()||i.length===0,className:"w-full max-w-md backdrop-blur-sm",children:v?"Creating Issue...":"Create Issue"}),o&&t.jsx(y,{variant:"secondary",size:"md",onClick:o,disabled:v,className:"backdrop-blur-sm",children:"Cancel"})]})})]})})]})},je=({galaxyId:x,onIssueCreated:p})=>{const[o,l]=r.useState(!1),g=()=>{l(!1),setTimeout(()=>{p?.(),window.dispatchEvent(new CustomEvent(G.ISSUE_CREATED))},500)};return t.jsxs(t.Fragment,{children:[t.jsx(J,{children:t.jsx("div",{className:C("fixed bottom-4 right-1/2 translate-x-1/2 z-[100]","backdrop-blur-md bg-white/90 dark:bg-slate-900/90","border border-slate-200/50 dark:border-slate-700/50","rounded-lg shadow-lg","transition-all duration-300","hover:shadow-xl hover:scale-105","pointer-events-auto"),children:t.jsxs(y,{variant:"primary",outline:!0,size:"lg",onClick:()=>l(!0),className:"px-6 py-3 flex items-center gap-2 pointer-events-auto",children:[t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),t.jsx("span",{children:"Create Issue"})]})})}),o&&t.jsx(Q,{galaxyId:x,onSuccess:g,onCancel:()=>l(!1)})]})};export{je as default};
