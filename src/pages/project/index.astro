---
import GalaxyLayout from "@/layouts/GalaxyLayout.astro";
import { MenuName } from "@/components/navbar/WorkNavbar.astro";

import { ProjectInfoProps } from "@/components/project/ProjectLink";
import ProjectLandingHero from "@/components/project/ProjectLandingHero";
import ProjectCTAPanel from "@/components/project/ProjectCTAPanel";
import PlaceCtaPanel from "@/components/project/PlaceCtaPanel";
import ProjectGoalPanel from "@/components/project/ProjectGoalPanel";
// import ProjectPeople from "@/components/project/ProjectPeoplePanel";
// import HighlightedInteraction from "@/components/project/HighlightedInteractionPanel";
import BackButton from "@/components/custom-ui/BackButton";
import AllStarsContest from "@/components/cosmos/AllStarsContest";
import { mockUserStars } from "@/data/mock-data";

// Place Mode: If the page is in place mode, the user can place their star on the web page.
const isPlaceMode = Astro.url.searchParams.get("place") === "true";

// Set draggable property on current user's star (for demo, using first star as current user)
const starsWithDraggable = mockUserStars.map((star, index) => ({
  ...star,
  draggable: isPlaceMode && index === 0, // First star is the current user's star
}));

// Get current user data (first star as current user for demo)
const currentUserData = mockUserStars[0];

const projectData: ProjectInfoProps = {
  uri: "/project",
  title: "Hyperpayment",
  isInfluencer: true,
  rating: {
    sunshines: 1250,
    stars: 3.47,
  },
  forks: 1,
  likes: 23,
  isFollowing: true,
  originalProject: "Original project",
  issue: "Issue: Windows support",
  description:
    "A protocol and it's implementation to transfer a resource between arbitrary amount parties. Used for example in Ara to distribute donations",
  license: "MIT License",
  balance: 1240,
  cascadeBalance: 350,
  totalAmount: 45,
  duration: "38 days",
  lastActivity: 1,
  totalCommits: 2000,
  commitsPerDay: "8 commits / day",
  openIssues: 12,
  closedIssues: 45,
  avgResponseTime: "1 day for reply",
  author: {
    uri: "/profile/alexjohnson",
    children: "Alex Johnson",
    rating: {
      ratingType: "maintainer",
      lvl: 220,
      maxLvl: 10,
      top: 10,
    },
  },
  stars: starsWithDraggable,
  originalProjectUrl: "",
  followers: 0,
  createdTime: 0,
  actions: [],
  projectGoal: 1000,
};
---

<GalaxyLayout
  active={MenuName.ProjectName}
  hideLinks={Object.keys(MenuName)}
  projectName={projectData.title}
  stars={projectData.stars}
  projectGoal={projectData.projectGoal}
  projectId={galaxyId}
>
  <AllStarsContest
    slot="header-navbar"
    client:only="react"
    projectGoal={projectData.projectGoal}
    currentStars={projectData.rating.stars}
    projectName={projectData.title}
    projectUri={projectData.uri}
    contest={{
      title: "Galaxy Formation Contest",
      description:
        "Projects that reach their star goal become galaxies and compete for prizes",
      goal: projectData.projectGoal || 1000,
      prize: "10,000 tokens + Featured placement",
      endTime: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days from now
      position: 5,
      contestFromDate: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), // 7 days ago
      contestToDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days from now
    }}
  />
  <BackButton slot="left" uri="/project/issues" />

  <!-- <NotificationBanner
    type="success"
    title="Quest System Updated!"
    slot="center"
    icon="success"
  >
    <span class="text-sm"
      >A quick task was added on Ara page. You are automatically
      following the issue.</span
    >
  </NotificationBanner>
  <NotificationBanner
    type="success"
    title="Quest System Updated!"
    slot="center"
    icon="success"
  >
    <span class="text-sm"
      >You are now following the project. Whenever it appears on the
      Ara, you will be notified.</span
    >
  </NotificationBanner> -->

  <ProjectLandingHero
    slot="center"
    projectData={projectData}
    projectUri={`/project/issues?galaxy=${projectId}`}
    githubUrl="https://github.com/ara-foundation/app"
    blockchainExplorerUrl="https://etherscan.io/address/0x1027298987234987234987234987234987234987"
    documentationUrl="https://docs.example.com"
    client:only="react"
  />
  {
    isPlaceMode && (
      <PlaceCtaPanel
        slot="center"
        client:only="react"
        userData={currentUserData}
      />
    )
  }
  {
    !isPlaceMode && (
      <ProjectCTAPanel
        slot="center"
        client:only="react"
        galaxyId={projectId}
        projectName={projectData.title}
      />
    )
  }

  <ProjectGoalPanel
    slot="right"
    client:only="react"
    stars={projectData.stars}
    totalStars={projectData.rating.stars}
    totalSunshines={projectData.rating.sunshines}
    goalStars={100}
    projectGoal={projectData.projectGoal}
    goalDonations={projectData.balance * 10}
    projectName={projectData.title}
  />

  <!-- <HighlightedInteraction slot="right" /> -->
  <!-- <ProjectPeople slot="right" /> -->
  <!-- <IssueInfoPanel slot="right" /> -->
</GalaxyLayout>
