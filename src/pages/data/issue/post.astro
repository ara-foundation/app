---
import Layout from "@/layouts/PanelViewLayout.astro";
import BackButton from "@/components/custom-ui/BackButton";
import { MenuItemProps } from "@/components/menu/MenuItem";
import { ChatTabs } from "@/components/chat";
import IssuePanel from "@/components/issue/IssuePanel";
import IssueStatsPanel from "@/components/issue/IssueStatsPanel";

import NotificationBanner from "@/components/NotificationBanner";

const additional: MenuItemProps[] = [
  {
    icon: "cascading-work",
    label: "Cascading Work",
    uri: "/maintainer/work",
  },
  {
    icon: "issue",
    label: "Issues List/Roadmap",
    uri: "/data/project",
    active: true,
  },
  {
    icon: "issue",
    label: "Issue",
    uri: "/data/issue",
    active: true,
  },
];

// Project ID + Not Yet Created + Fork Project means issue is created for the
// original project forked by project ID.
const projectId = Astro.url.searchParams.get("projectId") || undefined;
const notYetCreated = Astro.url.searchParams.get("notYetCreated") || false;
const forkProject = Astro.url.searchParams.get("forkProject") || undefined;

const isForOriginal = projectId && notYetCreated && forkProject;

const backHref = isForOriginal
  ? "/data/project/post?projectId=1&forkProjectId=1&createdIssueId=1"
  : "/data/issue";
---

<Layout additional={additional}>
  <BackButton slot="left" uri={backHref} />
  <NotificationBanner
    slot="center"
    type="warning"
    title="Adding a new issue"
    icon="warning"
    >{
      isForOriginal
        ? `Create an issue for '${forkProject}' that describes your fork`
        : "You are adding a new issue"
    }</NotificationBanner
  >

  <IssuePanel
    slot="center"
    uri="/data/issue"
    editable={true}
    number={"0"}
    title="Issue Title"
    description="Issue description."
    type="improvement"
    storage="arada-"
    projectId="1"
    categoryId="1"
    stats={{}}
    vpAmount={0}
    currentVP={0}
    topVP={0}
    minVP={0}
    client:load
  />
  <IssueStatsPanel slot="right" editable={true} client:load />
  <ChatTabs slot="right" client:load />
</Layout>

<style is:global>
  @import "@chatscope/chat-ui-kit-styles/dist/default/styles.min.css";
</style>
