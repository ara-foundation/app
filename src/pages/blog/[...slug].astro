---
export const prerender = false;

// Blog slug to ID mapping for legacy URLs
const BLOG_REDIRECTS: Record<string, string> = {
    "turning-code-piece-into-restful-api-with-sds-package":
        "694afd931c334e53420abeb9",
    "turning-reflect-into-restful-api-with-sds-package":
        "694afd931c334e53420abeba",
};

// Get the slug from params (Astro catch-all routes provide slug as string or array)
const slugParam = Astro.params.slug;
let slug: string;

// Handle both string and array formats
if (Array.isArray(slugParam)) {
    slug = slugParam.join("/");
} else if (typeof slugParam === "string") {
    slug = slugParam;
} else {
    slug = "";
}

// Check if this slug has a redirect mapping
const blogId = BLOG_REDIRECTS[slug];

if (blogId) {
    // Redirect to the blog page with the ID query parameter (301 permanent redirect)
    return new Response(null, {
        status: 301,
        headers: {
            Location: `/blog?id=${blogId}`,
        },
    });
} else {
    // If no redirect mapping found, return 404
    return Astro.redirect("/star/404?method=blogSlugNotFound");
}
---
